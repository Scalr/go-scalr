// Code generated by scalr-gen. DO NOT EDIT.

package schemas

import (
	"encoding/json"

	"github.com/scalr/go-scalr/v2/scalr/value"
)

// Response version - used when unmarshalling from API responses
// Represents the link between a hook and an environment.
type HookEnvironmentLink struct {
	ID            string                           `json:"id"`
	Type          string                           `json:"type"`
	Attributes    HookEnvironmentLinkAttributes    `json:"attributes"`
	Relationships HookEnvironmentLinkRelationships `json:"relationships"`
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r HookEnvironmentLink) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r HookEnvironmentLink) GetResourceType() string {
	if r.Type != "" {
		return r.Type
	}
	return "hook-environment-links"
}

// HookEnvironmentLinkAttributes holds the attributes for HookEnvironmentLink (response)
type HookEnvironmentLinkAttributes struct {
	// The list of events the hook is enabled for.
	Events []string `json:"events"`
}

// HookEnvironmentLinkRelationships holds the relationships for HookEnvironmentLink (response)
type HookEnvironmentLinkRelationships struct {
	// The environment associated with this link.
	Environment *Environment `json:"environment"`
	// The hook associated with this link.
	Hook *Hook `json:"hook"`
	// The VCS provider associated with the hook.
	VcsProvider *VcsProvider `json:"vcs-provider"`
	// The Git commit information when the hook was fetched from VCS.
	VcsRevision *VcsRevision `json:"vcs-revision"`
}

// UnmarshalJSON implements custom unmarshalling for relationships
func (r *HookEnvironmentLinkRelationships) UnmarshalJSON(data []byte) error {
	// Parse into temporary structure that matches JSON:API format
	var temp map[string]json.RawMessage
	if err := json.Unmarshal(data, &temp); err != nil {
		return err
	}

	if raw, ok := temp["environment"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Environment = &Environment{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["hook"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Hook = &Hook{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["vcs-provider"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.VcsProvider = &VcsProvider{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["vcs-revision"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.VcsRevision = &VcsRevision{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	return nil
}

// PopulateIncludes merges included resources into the relationships
func (r *HookEnvironmentLinkRelationships) PopulateIncludes(included []map[string]interface{}) {
	if r == nil || len(included) == 0 {
		return
	}

	// Build a map of included resources by type+id for fast lookup
	includedMap := make(map[string]map[string]interface{})
	for _, inc := range included {
		if id, ok := inc["id"].(string); ok {
			if typ, ok := inc["type"].(string); ok {
				key := typ + ":" + id
				includedMap[key] = inc
			}
		}
	}

	// Populate to-one relationship: Environment
	if r.Environment != nil && r.Environment.ID != "" {
		key := r.Environment.Type + ":" + r.Environment.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Environment
			if err := json.Unmarshal(data, &full); err == nil {
				r.Environment = &full
			}
		}
	}
	// Populate to-one relationship: Hook
	if r.Hook != nil && r.Hook.ID != "" {
		key := r.Hook.Type + ":" + r.Hook.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Hook
			if err := json.Unmarshal(data, &full); err == nil {
				r.Hook = &full
			}
		}
	}
	// Populate to-one relationship: VcsProvider
	if r.VcsProvider != nil && r.VcsProvider.ID != "" {
		key := r.VcsProvider.Type + ":" + r.VcsProvider.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full VcsProvider
			if err := json.Unmarshal(data, &full); err == nil {
				r.VcsProvider = &full
			}
		}
	}
	// Populate to-one relationship: VcsRevision
	if r.VcsRevision != nil && r.VcsRevision.ID != "" {
		key := r.VcsRevision.Type + ":" + r.VcsRevision.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full VcsRevision
			if err := json.Unmarshal(data, &full); err == nil {
				r.VcsRevision = &full
			}
		}
	}
}

// Request version - used when marshalling for API requests
// Represents the link between a hook and an environment. (for requests)
type HookEnvironmentLinkRequest struct {
	ID            string                                  `json:"id,omitempty"`
	Type          string                                  `json:"type,omitempty"`
	Attributes    HookEnvironmentLinkAttributesRequest    `json:"attributes,omitempty"`
	Relationships HookEnvironmentLinkRelationshipsRequest `json:"relationships,omitempty"`
}

// MarshalJSON automatically sets the Type field during marshalling
func (r HookEnvironmentLinkRequest) MarshalJSON() ([]byte, error) {
	type Alias HookEnvironmentLinkRequest
	if r.Type == "" {
		r.Type = "hook-environment-links"
	}
	return json.Marshal((Alias)(r))
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r HookEnvironmentLinkRequest) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r HookEnvironmentLinkRequest) GetResourceType() string {
	return "hook-environment-links"
}

// HookEnvironmentLinkAttributesRequest holds the attributes for HookEnvironmentLink (request)
type HookEnvironmentLinkAttributesRequest struct {
	// The list of events the hook is enabled for.
	Events *value.Value[[]string] `json:"events,omitempty"`
}

// HookEnvironmentLinkRelationshipsRequest holds the relationships for HookEnvironmentLink (request)
type HookEnvironmentLinkRelationshipsRequest struct {
	// The environment associated with this link.
	Environment *value.Value[Environment] `json:"environment,omitempty"`
	// The hook associated with this link.
	Hook *value.Value[Hook] `json:"hook,omitempty"`
}
