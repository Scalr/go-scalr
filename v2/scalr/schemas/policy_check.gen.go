// Code generated by scalr-gen. DO NOT EDIT.

package schemas

import (
	"encoding/json"

	"github.com/scalr/go-scalr/v2/scalr/value"
)

// Response version - used when unmarshalling from API responses
// A policy check contains the details of the policy check phase of a run in Scalr. Policy check is performed immediately after Terraform plan and cost estimation have completed for every run in every workspace, including dry runs, where policies have been linked.
type PolicyCheck struct {
	ID         string                `json:"id"`
	Type       string                `json:"type"`
	Attributes PolicyCheckAttributes `json:"attributes"`
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r PolicyCheck) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r PolicyCheck) GetResourceType() string {
	if r.Type != "" {
		return r.Type
	}
	return "policy-checks"
}

// PolicyCheckAttributes holds the attributes for PolicyCheck (response)
type PolicyCheckAttributes struct {
	Permissions map[string]interface{} `json:"permissions"`
	// OPA policy decision.
	Result PolicyCheckResultNested `json:"result"`
	// The Policy checks's current status. Transient states: * `pending` - The initial status of a policy check once it has been created. * `queued` - The policy check has been queued, awaiting backend service capacity to run terraform. * `running` - The policy check is running. * `soft_failed` Policy check has finished, and run hasn't passed policy with the `soft` level. User having `policy-checks:override` permission can override the policy check decision, and push this run next to apply. Final states: * `canceled` - The policy check has been canceled. * `errored` - The policy check has finished with an error. Attribute `error-message` contains the details. * `hard_failed` - Run hasn't passed policy with the `hard` level. * `overridden` - The policy check `soft_failed` status has been overridden. * `passed` - Run has successfully passed all configured policies. * `unreachable` - The policy check will not run.
	Status string `json:"status"`
	// Date/Time of transition to each status that has occurred.
	StatusTimestamps map[string]interface{} `json:"status-timestamps"`
}

// Request version - used when marshalling for API requests
// A policy check contains the details of the policy check phase of a run in Scalr. Policy check is performed immediately after Terraform plan and cost estimation have completed for every run in every workspace, including dry runs, where policies have been linked. (for requests)
type PolicyCheckRequest struct {
	ID         string                       `json:"id,omitempty"`
	Type       string                       `json:"type,omitempty"`
	Attributes PolicyCheckAttributesRequest `json:"attributes,omitempty"`
}

// MarshalJSON automatically sets the Type field during marshalling
func (r PolicyCheckRequest) MarshalJSON() ([]byte, error) {
	type Alias PolicyCheckRequest
	if r.Type == "" {
		r.Type = "policy-checks"
	}
	return json.Marshal((Alias)(r))
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r PolicyCheckRequest) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r PolicyCheckRequest) GetResourceType() string {
	return "policy-checks"
}

// PolicyCheckAttributesRequest holds the attributes for PolicyCheck (request)
type PolicyCheckAttributesRequest struct {
	Permissions *value.Value[map[string]interface{}] `json:"permissions,omitempty"`
	// OPA policy decision.
	Result *value.Value[PolicyCheckResultNestedRequest] `json:"result,omitempty"`
	// The Policy checks's current status. Transient states: * `pending` - The initial status of a policy check once it has been created. * `queued` - The policy check has been queued, awaiting backend service capacity to run terraform. * `running` - The policy check is running. * `soft_failed` Policy check has finished, and run hasn't passed policy with the `soft` level. User having `policy-checks:override` permission can override the policy check decision, and push this run next to apply. Final states: * `canceled` - The policy check has been canceled. * `errored` - The policy check has finished with an error. Attribute `error-message` contains the details. * `hard_failed` - Run hasn't passed policy with the `hard` level. * `overridden` - The policy check `soft_failed` status has been overridden. * `passed` - Run has successfully passed all configured policies. * `unreachable` - The policy check will not run.
	Status *value.Value[string] `json:"status,omitempty"`
	// Date/Time of transition to each status that has occurred.
	StatusTimestamps *value.Value[map[string]interface{}] `json:"status-timestamps,omitempty"`
}

// OPA policy decision.
type PolicyCheckResultNested struct {
	// Number of policy checks that have failed with 'advisory' level.
	AdvisoryFailed int `json:"advisory-failed"`
	// Duration of the policy check operation.
	DurationMs int `json:"duration-ms"`
	// Number of policy checks that have failed with "hard-mandatory" level.
	HardFailed int `json:"hard-failed"`
	// Number of policy checks that have passed.
	Passed int `json:"passed"`
	// List of policies that were checked.
	Policies []map[string]interface{} `json:"policies"`
	// Indicates whether all policy checks have passed without failures.
	Result bool `json:"result"`
	// Number of policy checks that have failed with "soft-mandatory" level.
	SoftFailed int `json:"soft-failed"`
	// Total number of policy checks that have failed.
	TotalFailed int `json:"total-failed"`
}

// OPA policy decision. (for requests)
type PolicyCheckResultNestedRequest struct {
	// Number of policy checks that have failed with 'advisory' level.
	AdvisoryFailed *value.Value[int] `json:"advisory-failed,omitempty"`
	// Duration of the policy check operation.
	DurationMs *value.Value[int] `json:"duration-ms,omitempty"`
	// Number of policy checks that have failed with "hard-mandatory" level.
	HardFailed *value.Value[int] `json:"hard-failed,omitempty"`
	// Number of policy checks that have passed.
	Passed *value.Value[int] `json:"passed,omitempty"`
	// List of policies that were checked.
	Policies *value.Value[[]map[string]interface{}] `json:"policies,omitempty"`
	// Indicates whether all policy checks have passed without failures.
	Result *value.Value[bool] `json:"result,omitempty"`
	// Number of policy checks that have failed with "soft-mandatory" level.
	SoftFailed *value.Value[int] `json:"soft-failed,omitempty"`
	// Total number of policy checks that have failed.
	TotalFailed *value.Value[int] `json:"total-failed,omitempty"`
}
