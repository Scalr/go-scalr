// Code generated by scalr-gen. DO NOT EDIT.

package schemas

import (
	"encoding/json"
	"time"

	"github.com/scalr/go-scalr/v2/scalr/value"
)

// Response version - used when unmarshalling from API responses
// Represents terraform resource instance usage
type TerraformResourceInstanceUsage struct {
	ID            string                                      `json:"id"`
	Type          string                                      `json:"type"`
	Attributes    TerraformResourceInstanceUsageAttributes    `json:"attributes"`
	Relationships TerraformResourceInstanceUsageRelationships `json:"relationships"`
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r TerraformResourceInstanceUsage) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r TerraformResourceInstanceUsage) GetResourceType() string {
	if r.Type != "" {
		return r.Type
	}
	return "tf-resource-instance-usages"
}

// TerraformResourceInstanceUsageAttributes holds the attributes for TerraformResourceInstanceUsage (response)
type TerraformResourceInstanceUsageAttributes struct {
	// Resource instance address. Combines module, name and index of the resource.
	Address string `json:"address"`
	// External ID of the resource instance.
	ExternalId string `json:"external-id"`
	// Indicates if the resource instance is active.
	IsActive bool `json:"is-active"`
	// Indicates if the resource is a duplicate
	IsDuplicate bool `json:"is-duplicate"`
	// Resource instance name.
	Name string `json:"name"`
	// Time when the resource instance was created or updated.
	UpdatedAt time.Time `json:"updated-at"`
	// The email of the user who create or update this resource instance.
	UpdatedByEmail string `json:"updated-by-email"`
	// Name of the workspace this resource instance belongs to.
	WorkspaceName string `json:"workspace-name"`
}

// TerraformResourceInstanceUsageRelationships holds the relationships for TerraformResourceInstanceUsage (response)
type TerraformResourceInstanceUsageRelationships struct {
	// The environment this resource instance belongs to.
	Environment *Environment `json:"environment"`
	// The resource this instance belongs to.
	Resource *TerraformResourceUsage `json:"resource"`
	// The run which created or updated this resource instance.
	Run *Run `json:"run"`
	// The state version this resource instance belongs to.
	StateVersion *StateVersion `json:"state-version"`
	// The workspace this resource instance belongs to.
	Workspace *Workspace `json:"workspace"`
}

// UnmarshalJSON implements custom unmarshalling for relationships
func (r *TerraformResourceInstanceUsageRelationships) UnmarshalJSON(data []byte) error {
	// Parse into temporary structure that matches JSON:API format
	var temp map[string]json.RawMessage
	if err := json.Unmarshal(data, &temp); err != nil {
		return err
	}

	if raw, ok := temp["environment"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Environment = &Environment{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["resource"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Resource = &TerraformResourceUsage{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["run"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Run = &Run{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["state-version"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.StateVersion = &StateVersion{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["workspace"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Workspace = &Workspace{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	return nil
}

// PopulateIncludes merges included resources into the relationships
func (r *TerraformResourceInstanceUsageRelationships) PopulateIncludes(included []map[string]interface{}) {
	if r == nil || len(included) == 0 {
		return
	}

	// Build a map of included resources by type+id for fast lookup
	includedMap := make(map[string]map[string]interface{})
	for _, inc := range included {
		if id, ok := inc["id"].(string); ok {
			if typ, ok := inc["type"].(string); ok {
				key := typ + ":" + id
				includedMap[key] = inc
			}
		}
	}

	// Populate to-one relationship: Environment
	if r.Environment != nil && r.Environment.ID != "" {
		key := r.Environment.Type + ":" + r.Environment.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Environment
			if err := json.Unmarshal(data, &full); err == nil {
				r.Environment = &full
			}
		}
	}
	// Populate to-one relationship: Resource
	if r.Resource != nil && r.Resource.ID != "" {
		key := r.Resource.Type + ":" + r.Resource.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full TerraformResourceUsage
			if err := json.Unmarshal(data, &full); err == nil {
				r.Resource = &full
			}
		}
	}
	// Populate to-one relationship: Run
	if r.Run != nil && r.Run.ID != "" {
		key := r.Run.Type + ":" + r.Run.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Run
			if err := json.Unmarshal(data, &full); err == nil {
				r.Run = &full
			}
		}
	}
	// Populate to-one relationship: StateVersion
	if r.StateVersion != nil && r.StateVersion.ID != "" {
		key := r.StateVersion.Type + ":" + r.StateVersion.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full StateVersion
			if err := json.Unmarshal(data, &full); err == nil {
				r.StateVersion = &full
			}
		}
	}
	// Populate to-one relationship: Workspace
	if r.Workspace != nil && r.Workspace.ID != "" {
		key := r.Workspace.Type + ":" + r.Workspace.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Workspace
			if err := json.Unmarshal(data, &full); err == nil {
				r.Workspace = &full
			}
		}
	}
}

// Request version - used when marshalling for API requests
// Represents terraform resource instance usage (for requests)
type TerraformResourceInstanceUsageRequest struct {
	ID            string                                             `json:"id,omitempty"`
	Type          string                                             `json:"type,omitempty"`
	Attributes    TerraformResourceInstanceUsageAttributesRequest    `json:"attributes,omitempty"`
	Relationships TerraformResourceInstanceUsageRelationshipsRequest `json:"relationships,omitempty"`
}

// MarshalJSON automatically sets the Type field during marshalling
func (r TerraformResourceInstanceUsageRequest) MarshalJSON() ([]byte, error) {
	type Alias TerraformResourceInstanceUsageRequest
	if r.Type == "" {
		r.Type = "tf-resource-instance-usages"
	}
	return json.Marshal((Alias)(r))
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r TerraformResourceInstanceUsageRequest) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r TerraformResourceInstanceUsageRequest) GetResourceType() string {
	return "tf-resource-instance-usages"
}

// TerraformResourceInstanceUsageAttributesRequest holds the attributes for TerraformResourceInstanceUsage (request)
type TerraformResourceInstanceUsageAttributesRequest struct {
	// Resource instance address. Combines module, name and index of the resource.
	Address *value.Value[string] `json:"address,omitempty"`
	// External ID of the resource instance.
	ExternalId *value.Value[string] `json:"external-id,omitempty"`
	// Indicates if the resource instance is active.
	IsActive *value.Value[bool] `json:"is-active,omitempty"`
	// Indicates if the resource is a duplicate
	IsDuplicate *value.Value[bool] `json:"is-duplicate,omitempty"`
	// Resource instance name.
	Name *value.Value[string] `json:"name,omitempty"`
	// Time when the resource instance was created or updated.
	UpdatedAt *value.Value[time.Time] `json:"updated-at,omitempty"`
	// The email of the user who create or update this resource instance.
	UpdatedByEmail *value.Value[string] `json:"updated-by-email,omitempty"`
	// Name of the workspace this resource instance belongs to.
	WorkspaceName *value.Value[string] `json:"workspace-name,omitempty"`
}

// TerraformResourceInstanceUsageRelationshipsRequest holds the relationships for TerraformResourceInstanceUsage (request)
type TerraformResourceInstanceUsageRelationshipsRequest struct {
	// The environment this resource instance belongs to.
	Environment *value.Value[Environment] `json:"environment,omitempty"`
	// The resource this instance belongs to.
	Resource *value.Value[TerraformResourceUsage] `json:"resource,omitempty"`
	// The run which created or updated this resource instance.
	Run *value.Value[Run] `json:"run,omitempty"`
	// The state version this resource instance belongs to.
	StateVersion *value.Value[StateVersion] `json:"state-version,omitempty"`
	// The workspace this resource instance belongs to.
	Workspace *value.Value[Workspace] `json:"workspace,omitempty"`
}
