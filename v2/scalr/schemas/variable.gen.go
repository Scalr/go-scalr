// Code generated by scalr-gen. DO NOT EDIT.

package schemas

import (
	"encoding/json"
	"time"

	"github.com/scalr/go-scalr/v2/scalr/value"
)

// VariableCategory represents the type for VariableCategory
// * `terraform` - Values to be passed to terraform input variables of the same name. * `env` - shell environment variables. They will be injected via `export` during a terraform run.
type VariableCategory string

// VariableCategory constants
const (
	VariableCategoryTerraform VariableCategory = "terraform"
	VariableCategoryShell     VariableCategory = "shell"
	VariableCategoryEnv       VariableCategory = "env"
)

// Response version - used when unmarshalling from API responses
// A Variable describes the configuration and value of a variable in a workspace. In Scalr there are "terraform" and "environment" variables. * Terraform variables define values to be passed into the corresponding Terraform input variable that is defined in the Configuration Version to be used in a run. Scalr Terraform variables are added to the `terraform.tfvars.json` file in the working directory of the workspace prior to any run. The values passed in can be HCL structures if the `hcl` attribute is `true`. * Environment variables define shell variables that are added to the run time environment of a workspace using `export VAR=value`. These variables can pass authentication parameters to providers or any data required for local processing, such as via `local-exec` provisioners.
type Variable struct {
	ID            string                `json:"id"`
	Type          string                `json:"type"`
	Attributes    VariableAttributes    `json:"attributes"`
	Relationships VariableRelationships `json:"relationships"`
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r Variable) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r Variable) GetResourceType() string {
	if r.Type != "" {
		return r.Type
	}
	return "vars"
}

// VariableAttributes holds the attributes for Variable (response)
type VariableAttributes struct {
	// * `terraform` - Values to be passed to terraform input variables of the same name. * `env` - shell environment variables. They will be injected via `export` during a terraform run.
	Category VariableCategory `json:"category"`
	// Variable description.
	Description *string `json:"description"`
	// Indicates whether the variable can be overridden on a lower down the Scalr organizational model.
	Final bool `json:"final"`
	// Indicates whether the value of the variable is a string of HCL code. Not applicable to `env` category variables.
	Hcl bool `json:"hcl"`
	// Variable name. Must correspond to the name of a Terraform input variable in the configuration if category is terraform.
	Key string `json:"key"`
	// Indicates whether the value is sensitive. When set to `true` then the variable is not visible after being written.
	Sensitive bool `json:"sensitive"`
	// The variable last update timestamp.
	UpdatedAt *time.Time `json:"updated-at"`
	// The email of the last user who updated this variable.
	UpdatedByEmail *string `json:"updated-by-email"`
	// Variable value. Not visible if sensitive: true is enabled
	Value *string `json:"value"`
}

// VariableRelationships holds the relationships for Variable (response)
type VariableRelationships struct {
	// The account this variable belongs to
	Account *Account `json:"account"`
	// The environment this variable belongs to
	Environment *Environment `json:"environment"`
	// The user who updated this variable last time.
	UpdatedBy *User `json:"updated-by"`
	// The workspace this variable belongs to.
	Workspace *Workspace `json:"workspace"`
}

// UnmarshalJSON implements custom unmarshalling for relationships
func (r *VariableRelationships) UnmarshalJSON(data []byte) error {
	// Parse into temporary structure that matches JSON:API format
	var temp map[string]json.RawMessage
	if err := json.Unmarshal(data, &temp); err != nil {
		return err
	}

	if raw, ok := temp["account"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Account = &Account{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["environment"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Environment = &Environment{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["updated-by"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.UpdatedBy = &User{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["workspace"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Workspace = &Workspace{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	return nil
}

// PopulateIncludes merges included resources into the relationships
func (r *VariableRelationships) PopulateIncludes(included []map[string]interface{}) {
	if r == nil || len(included) == 0 {
		return
	}

	// Build a map of included resources by type+id for fast lookup
	includedMap := make(map[string]map[string]interface{})
	for _, inc := range included {
		if id, ok := inc["id"].(string); ok {
			if typ, ok := inc["type"].(string); ok {
				key := typ + ":" + id
				includedMap[key] = inc
			}
		}
	}

	// Populate to-one relationship: Account
	if r.Account != nil && r.Account.ID != "" {
		key := r.Account.Type + ":" + r.Account.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Account
			if err := json.Unmarshal(data, &full); err == nil {
				r.Account = &full
			}
		}
	}
	// Populate to-one relationship: Environment
	if r.Environment != nil && r.Environment.ID != "" {
		key := r.Environment.Type + ":" + r.Environment.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Environment
			if err := json.Unmarshal(data, &full); err == nil {
				r.Environment = &full
			}
		}
	}
	// Populate to-one relationship: UpdatedBy
	if r.UpdatedBy != nil && r.UpdatedBy.ID != "" {
		key := r.UpdatedBy.Type + ":" + r.UpdatedBy.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full User
			if err := json.Unmarshal(data, &full); err == nil {
				r.UpdatedBy = &full
			}
		}
	}
	// Populate to-one relationship: Workspace
	if r.Workspace != nil && r.Workspace.ID != "" {
		key := r.Workspace.Type + ":" + r.Workspace.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Workspace
			if err := json.Unmarshal(data, &full); err == nil {
				r.Workspace = &full
			}
		}
	}
}

// Request version - used when marshalling for API requests
// A Variable describes the configuration and value of a variable in a workspace. In Scalr there are "terraform" and "environment" variables. * Terraform variables define values to be passed into the corresponding Terraform input variable that is defined in the Configuration Version to be used in a run. Scalr Terraform variables are added to the `terraform.tfvars.json` file in the working directory of the workspace prior to any run. The values passed in can be HCL structures if the `hcl` attribute is `true`. * Environment variables define shell variables that are added to the run time environment of a workspace using `export VAR=value`. These variables can pass authentication parameters to providers or any data required for local processing, such as via `local-exec` provisioners. (for requests)
type VariableRequest struct {
	ID            string                       `json:"id,omitempty"`
	Type          string                       `json:"type,omitempty"`
	Attributes    VariableAttributesRequest    `json:"attributes,omitempty"`
	Relationships VariableRelationshipsRequest `json:"relationships,omitempty"`
}

// MarshalJSON automatically sets the Type field during marshalling
func (r VariableRequest) MarshalJSON() ([]byte, error) {
	type Alias VariableRequest
	if r.Type == "" {
		r.Type = "vars"
	}
	return json.Marshal((Alias)(r))
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r VariableRequest) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r VariableRequest) GetResourceType() string {
	return "vars"
}

// VariableAttributesRequest holds the attributes for Variable (request)
type VariableAttributesRequest struct {
	// * `terraform` - Values to be passed to terraform input variables of the same name. * `env` - shell environment variables. They will be injected via `export` during a terraform run.
	Category *value.Value[VariableCategory] `json:"category,omitempty"`
	// Variable description.
	Description *value.Value[string] `json:"description,omitempty"`
	// Indicates whether the variable can be overridden on a lower down the Scalr organizational model.
	Final *value.Value[bool] `json:"final,omitempty"`
	// Indicates whether the value of the variable is a string of HCL code. Not applicable to `env` category variables.
	Hcl *value.Value[bool] `json:"hcl,omitempty"`
	// Variable name. Must correspond to the name of a Terraform input variable in the configuration if category is terraform.
	Key *value.Value[string] `json:"key,omitempty"`
	// Indicates whether the value is sensitive. When set to `true` then the variable is not visible after being written.
	Sensitive *value.Value[bool] `json:"sensitive,omitempty"`
	// Variable value. Not visible if sensitive: true is enabled
	Value *value.Value[string] `json:"value,omitempty"`
}

// VariableRelationshipsRequest holds the relationships for Variable (request)
type VariableRelationshipsRequest struct {
	// The environment this variable belongs to
	Environment *value.Value[Environment] `json:"environment,omitempty"`
	// The workspace this variable belongs to.
	Workspace *value.Value[Workspace] `json:"workspace,omitempty"`
}
