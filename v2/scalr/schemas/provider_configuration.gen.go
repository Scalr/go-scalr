// Code generated by scalr-gen. DO NOT EDIT.

package schemas

import (
	"encoding/json"

	"github.com/scalr/go-scalr/v2/scalr/value"
)

// Response version - used when unmarshalling from API responses
// The configuration of provider. Provider configuration is managed on the account scope and can be linked to environments or workspaces.
type ProviderConfiguration struct {
	ID            string                             `json:"id"`
	Type          string                             `json:"type"`
	Attributes    ProviderConfigurationAttributes    `json:"attributes"`
	Relationships ProviderConfigurationRelationships `json:"relationships"`
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r ProviderConfiguration) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r ProviderConfiguration) GetResourceType() string {
	if r.Type != "" {
		return r.Type
	}
	return "provider-configurations"
}

// ProviderConfigurationAttributes holds the attributes for ProviderConfiguration (response)
type ProviderConfigurationAttributes struct {
	// AWS access key. This option is required with the `access_keys` credential type.
	AwsAccessKey *string `json:"aws-access-key"`
	// The type of AWS account, available options: `regular`, `gov-cloud`, `cn-cloud`.
	AwsAccountType *string `json:"aws-account-type"`
	// The value of the aud claim for the identity token.
	AwsAudience *string `json:"aws-audience"`
	// The type of AWS credential, available options: `access_keys`, `role_delegation`, `oidc`.
	AwsCredentialsType *string `json:"aws-credentials-type"`
	// Default tags to be applied to all resources created by this provider configuration.
	AwsDefaultTags *map[string]interface{} `json:"aws-default-tags"`
	// On duplicate key behaviour for default tags. Available options: - `skip`: the existing tags will not be changed - `update`: the existing tags will be replaced with the new one
	AwsDefaultTagsStrategy *string `json:"aws-default-tags-strategy"`
	// External identifier to use when assuming the role. This option is required with the `role_delegation` credential type.
	AwsExternalId *string `json:"aws-external-id"`
	// Amazon Resource Name (ARN) of the IAM Role to assume. This option is required with the `role_delegation` and `oidc` credential type.
	AwsRoleArn *string `json:"aws-role-arn"`
	// AWS secret key. This option is required with the `access_keys` credential type.
	AwsSecretKey *string `json:"aws-secret-key"`
	// Trusted entity type, available options: `aws_account`, `aws_service`. This option is required with the `role_delegation` credential type.
	AwsTrustedEntityType *string `json:"aws-trusted-entity-type"`
	// The value of the aud claim for the identity token.
	AzurermAudience *string `json:"azurerm-audience"`
	// The type of azurerm credentials, available options: `client-secrets`, `oidc`.
	AzurermAuthType *string `json:"azurerm-auth-type"`
	// The Client ID which should be used.
	AzurermClientId *string `json:"azurerm-client-id"`
	// The Client Secret which should be used.
	AzurermClientSecret *string `json:"azurerm-client-secret"`
	// The Subscription ID which should be used.
	AzurermSubscriptionId *string `json:"azurerm-subscription-id"`
	// The Tenant ID should be used.
	AzurermTenantId *string `json:"azurerm-tenant-id"`
	// Contains the error message if the provider configuration is in an `errored` status.
	ErrorMessage *string `json:"error-message"`
	// Export provider variables into the run environment. This option is available only for built in providers.
	ExportShellVariables bool `json:"export-shell-variables"`
	// Authentication type to access GCP.
	GoogleAuthType *string `json:"google-auth-type"`
	// Service account key file in JSON format.
	GoogleCredentials *string `json:"google-credentials"`
	// The default project to manage resources in. If another project is specified on a resource, it will take precedence.
	GoogleProject *string `json:"google-project"`
	// The service account email Scalr will use when authenticating to GCP.
	GoogleServiceAccountEmail *string `json:"google-service-account-email"`
	// Service account name.
	GoogleServiceAccountName *string `json:"google-service-account-name"`
	// If the project will be enforced.
	GoogleUseDefaultProject *bool `json:"google-use-default-project"`
	// The canonical name of the workload identity provider.
	GoogleWorkloadProviderName *string `json:"google-workload-provider-name"`
	// Determines if a provider configuration is custom. Note: custom provider configurations do not support built-in features like exporting as shell variables or on-save validation. Provider configuration will be validated during the run only.
	IsCustom *bool `json:"is-custom"`
	// Indicates whether the provider configuration can be used in any workspace of the account without directly linking it to the environment.
	IsShared bool `json:"is-shared"`
	// The name of a Scalr provider configuration. This field is unique for the account.
	Name string `json:"name"`
	// The name of a Terraform provider.
	ProviderName interface{} `json:"provider-name"`
	// The Scalr hostname which should be used.
	ScalrHostname *string `json:"scalr-hostname"`
	// The Scalr token which should be used.
	ScalrToken *string `json:"scalr-token"`
	// Provider configuration status. Can be: `active`, `errored`.
	Status string `json:"status"`
}

// ProviderConfigurationRelationships holds the relationships for ProviderConfiguration (response)
type ProviderConfigurationRelationships struct {
	// The account this provider configuration belongs to.
	Account *Account `json:"account"`
	// The list of environments attached to the provider configuration. Can be used to bulk link/unlink environments.
	Environments []*Environment `json:"environments"`
	// The teams, the provider configuration belongs to.
	Owners []*Team `json:"owners"`
	// The list of arguments for provider configurations.
	Parameters []*ProviderConfigurationParameter `json:"parameters"`
}

// UnmarshalJSON implements custom unmarshalling for relationships
func (r *ProviderConfigurationRelationships) UnmarshalJSON(data []byte) error {
	// Parse into temporary structure that matches JSON:API format
	var temp map[string]json.RawMessage
	if err := json.Unmarshal(data, &temp); err != nil {
		return err
	}

	if raw, ok := temp["account"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Account = &Account{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["environments"]; ok {
		// To-many relationship
		var rel struct {
			Data []struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Environments = make([]*Environment, len(rel.Data))
			for i, d := range rel.Data {
				r.Environments[i] = &Environment{
					ID:   d.ID,
					Type: d.Type,
				}
			}
		}
	}
	if raw, ok := temp["owners"]; ok {
		// To-many relationship
		var rel struct {
			Data []struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Owners = make([]*Team, len(rel.Data))
			for i, d := range rel.Data {
				r.Owners[i] = &Team{
					ID:   d.ID,
					Type: d.Type,
				}
			}
		}
	}
	if raw, ok := temp["parameters"]; ok {
		// To-many relationship
		var rel struct {
			Data []struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Parameters = make([]*ProviderConfigurationParameter, len(rel.Data))
			for i, d := range rel.Data {
				r.Parameters[i] = &ProviderConfigurationParameter{
					ID:   d.ID,
					Type: d.Type,
				}
			}
		}
	}
	return nil
}

// PopulateIncludes merges included resources into the relationships
func (r *ProviderConfigurationRelationships) PopulateIncludes(included []map[string]interface{}) {
	if r == nil || len(included) == 0 {
		return
	}

	// Build a map of included resources by type+id for fast lookup
	includedMap := make(map[string]map[string]interface{})
	for _, inc := range included {
		if id, ok := inc["id"].(string); ok {
			if typ, ok := inc["type"].(string); ok {
				key := typ + ":" + id
				includedMap[key] = inc
			}
		}
	}

	// Populate to-one relationship: Account
	if r.Account != nil && r.Account.ID != "" {
		key := r.Account.Type + ":" + r.Account.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Account
			if err := json.Unmarshal(data, &full); err == nil {
				r.Account = &full
			}
		}
	}
	// Populate to-many relationship: Environments
	if r.Environments != nil {
		for i, resource := range r.Environments {
			if resource != nil && resource.ID != "" {
				key := resource.Type + ":" + resource.ID
				if fullResource, ok := includedMap[key]; ok {
					// Unmarshal the full resource
					data, _ := json.Marshal(fullResource)
					var full Environment
					if err := json.Unmarshal(data, &full); err == nil {
						r.Environments[i] = &full
					}
				}
			}
		}
	}
	// Populate to-many relationship: Owners
	if r.Owners != nil {
		for i, resource := range r.Owners {
			if resource != nil && resource.ID != "" {
				key := resource.Type + ":" + resource.ID
				if fullResource, ok := includedMap[key]; ok {
					// Unmarshal the full resource
					data, _ := json.Marshal(fullResource)
					var full Team
					if err := json.Unmarshal(data, &full); err == nil {
						r.Owners[i] = &full
					}
				}
			}
		}
	}
	// Populate to-many relationship: Parameters
	if r.Parameters != nil {
		for i, resource := range r.Parameters {
			if resource != nil && resource.ID != "" {
				key := resource.Type + ":" + resource.ID
				if fullResource, ok := includedMap[key]; ok {
					// Unmarshal the full resource
					data, _ := json.Marshal(fullResource)
					var full ProviderConfigurationParameter
					if err := json.Unmarshal(data, &full); err == nil {
						r.Parameters[i] = &full
					}
				}
			}
		}
	}
}

// Request version - used when marshalling for API requests
// The configuration of provider. Provider configuration is managed on the account scope and can be linked to environments or workspaces. (for requests)
type ProviderConfigurationRequest struct {
	ID            string                                    `json:"id,omitempty"`
	Type          string                                    `json:"type,omitempty"`
	Attributes    ProviderConfigurationAttributesRequest    `json:"attributes,omitempty"`
	Relationships ProviderConfigurationRelationshipsRequest `json:"relationships,omitempty"`
}

// MarshalJSON automatically sets the Type field during marshalling
func (r ProviderConfigurationRequest) MarshalJSON() ([]byte, error) {
	type Alias ProviderConfigurationRequest
	if r.Type == "" {
		r.Type = "provider-configurations"
	}
	return json.Marshal((Alias)(r))
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r ProviderConfigurationRequest) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r ProviderConfigurationRequest) GetResourceType() string {
	return "provider-configurations"
}

// ProviderConfigurationAttributesRequest holds the attributes for ProviderConfiguration (request)
type ProviderConfigurationAttributesRequest struct {
	// AWS access key. This option is required with the `access_keys` credential type.
	AwsAccessKey *value.Value[string] `json:"aws-access-key,omitempty"`
	// The type of AWS account, available options: `regular`, `gov-cloud`, `cn-cloud`.
	AwsAccountType *value.Value[string] `json:"aws-account-type,omitempty"`
	// The value of the aud claim for the identity token.
	AwsAudience *value.Value[string] `json:"aws-audience,omitempty"`
	// The type of AWS credential, available options: `access_keys`, `role_delegation`, `oidc`.
	AwsCredentialsType *value.Value[string] `json:"aws-credentials-type,omitempty"`
	// Default tags to be applied to all resources created by this provider configuration.
	AwsDefaultTags *value.Value[map[string]interface{}] `json:"aws-default-tags,omitempty"`
	// On duplicate key behaviour for default tags. Available options: - `skip`: the existing tags will not be changed - `update`: the existing tags will be replaced with the new one
	AwsDefaultTagsStrategy *value.Value[string] `json:"aws-default-tags-strategy,omitempty"`
	// External identifier to use when assuming the role. This option is required with the `role_delegation` credential type.
	AwsExternalId *value.Value[string] `json:"aws-external-id,omitempty"`
	// Amazon Resource Name (ARN) of the IAM Role to assume. This option is required with the `role_delegation` and `oidc` credential type.
	AwsRoleArn *value.Value[string] `json:"aws-role-arn,omitempty"`
	// AWS secret key. This option is required with the `access_keys` credential type.
	AwsSecretKey *value.Value[string] `json:"aws-secret-key,omitempty"`
	// Trusted entity type, available options: `aws_account`, `aws_service`. This option is required with the `role_delegation` credential type.
	AwsTrustedEntityType *value.Value[string] `json:"aws-trusted-entity-type,omitempty"`
	// The value of the aud claim for the identity token.
	AzurermAudience *value.Value[string] `json:"azurerm-audience,omitempty"`
	// The type of azurerm credentials, available options: `client-secrets`, `oidc`.
	AzurermAuthType *value.Value[string] `json:"azurerm-auth-type,omitempty"`
	// The Client ID which should be used.
	AzurermClientId *value.Value[string] `json:"azurerm-client-id,omitempty"`
	// The Client Secret which should be used.
	AzurermClientSecret *value.Value[string] `json:"azurerm-client-secret,omitempty"`
	// The Subscription ID which should be used.
	AzurermSubscriptionId *value.Value[string] `json:"azurerm-subscription-id,omitempty"`
	// The Tenant ID should be used.
	AzurermTenantId *value.Value[string] `json:"azurerm-tenant-id,omitempty"`
	// Export provider variables into the run environment. This option is available only for built in providers.
	ExportShellVariables *value.Value[bool] `json:"export-shell-variables,omitempty"`
	// Authentication type to access GCP.
	GoogleAuthType *value.Value[string] `json:"google-auth-type,omitempty"`
	// Service account key file in JSON format.
	GoogleCredentials *value.Value[string] `json:"google-credentials,omitempty"`
	// The default project to manage resources in. If another project is specified on a resource, it will take precedence.
	GoogleProject *value.Value[string] `json:"google-project,omitempty"`
	// The service account email Scalr will use when authenticating to GCP.
	GoogleServiceAccountEmail *value.Value[string] `json:"google-service-account-email,omitempty"`
	// If the project will be enforced.
	GoogleUseDefaultProject *value.Value[bool] `json:"google-use-default-project,omitempty"`
	// The canonical name of the workload identity provider.
	GoogleWorkloadProviderName *value.Value[string] `json:"google-workload-provider-name,omitempty"`
	// Determines if a provider configuration is custom. Note: custom provider configurations do not support built-in features like exporting as shell variables or on-save validation. Provider configuration will be validated during the run only.
	IsCustom *value.Value[bool] `json:"is-custom,omitempty"`
	// Indicates whether the provider configuration can be used in any workspace of the account without directly linking it to the environment.
	IsShared *value.Value[bool] `json:"is-shared,omitempty"`
	// The name of a Scalr provider configuration. This field is unique for the account.
	Name *value.Value[string] `json:"name,omitempty"`
	// The name of a Terraform provider.
	ProviderName *value.Value[interface{}] `json:"provider-name,omitempty"`
	// The Scalr hostname which should be used.
	ScalrHostname *value.Value[string] `json:"scalr-hostname,omitempty"`
	// The Scalr token which should be used.
	ScalrToken *value.Value[string] `json:"scalr-token,omitempty"`
}

// ProviderConfigurationRelationshipsRequest holds the relationships for ProviderConfiguration (request)
type ProviderConfigurationRelationshipsRequest struct {
	// The account this provider configuration belongs to.
	Account *value.Value[Account] `json:"account,omitempty"`
	// The list of environments attached to the provider configuration. Can be used to bulk link/unlink environments.
	Environments *value.Value[[]Environment] `json:"environments,omitempty"`
	// The teams, the provider configuration belongs to.
	Owners *value.Value[[]Team] `json:"owners,omitempty"`
}
