// Code generated by scalr-gen. DO NOT EDIT.

package schemas

import (
	"encoding/json"

	"github.com/scalr/go-scalr/v2/scalr/value"
)

// VcsProviderAuthType represents the type for VcsProviderAuthType
// Authentication type, the VCS API client is using to establish connection with the VCS. * `oauth2` - private OAuth App, user or organization creates in their VCS account. Setup through this method requires a user to complete a [web flow through a browser](/docs/github), where the user should authorize Scalr to connect to their OAuth App. * `personal_token` - a pre-generated authentication token. This method works better if you need to fully automate the VCS provider creation. How to generate access tokens for different VCS providers: * [GitHub and GitHub Enterprise](https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token) * [GitLab and GitLab Enterprise](https://docs.gitlab.com/ce/user/profile/personal_access_tokens.html#creating-a-personal-access-token) * [Azure DevOps](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops-2019&tabs=preview-page) * [Bitbucket Data Center](https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html)
type VcsProviderAuthType string

// VcsProviderAuthType constants
const (
	VcsProviderAuthTypeOauth2        VcsProviderAuthType = "oauth2"
	VcsProviderAuthTypePersonalToken VcsProviderAuthType = "personal_token"
)

// VcsProviderVcsType represents the type for VcsProviderVcsType
// VCS provider type.
type VcsProviderVcsType string

// VcsProviderVcsType constants
const (
	VcsProviderVcsTypeGithub              VcsProviderVcsType = "github"
	VcsProviderVcsTypeGitlab              VcsProviderVcsType = "gitlab"
	VcsProviderVcsTypeBitbucket           VcsProviderVcsType = "bitbucket"
	VcsProviderVcsTypeBitbucketEnterprise VcsProviderVcsType = "bitbucket_enterprise"
	VcsProviderVcsTypeGitlabEnterprise    VcsProviderVcsType = "gitlab_enterprise"
	VcsProviderVcsTypeGithubEnterprise    VcsProviderVcsType = "github_enterprise"
	VcsProviderVcsTypeAzureDevOpsServices VcsProviderVcsType = "azure_dev_ops_services"
)

// VcsProviderCompareStrategy represents the type for VcsProviderCompareStrategy
// Designates which commit is compared with the head commit to produce diff changes.
type VcsProviderCompareStrategy string

// VcsProviderCompareStrategy constants
const (
	VcsProviderCompareStrategyBaseCommit     VcsProviderCompareStrategy = "base-commit"
	VcsProviderCompareStrategyPreviousCommit VcsProviderCompareStrategy = "previous-commit"
)

// Response version - used when unmarshalling from API responses
// The VCS Provider resource represents a connection between a Scalr account and a VCS, such as GitHub, Gitlab, Bitbucket, and Azure DevOps.
type VcsProvider struct {
	ID            string                   `json:"id"`
	Type          string                   `json:"type"`
	Attributes    VcsProviderAttributes    `json:"attributes"`
	Relationships VcsProviderRelationships `json:"relationships"`
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r VcsProvider) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r VcsProvider) GetResourceType() string {
	if r.Type != "" {
		return r.Type
	}
	return "vcs-providers"
}

// VcsProviderAttributes holds the attributes for VcsProvider (response)
type VcsProviderAttributes struct {
	// Indicates whether triggering apply runs from a PR comment is enabled for this VCS provider.
	AppliesEnabled bool `json:"applies-enabled"`
	// Authentication type, the VCS API client is using to establish connection with the VCS. * `oauth2` - private OAuth App, user or organization creates in their VCS account. Setup through this method requires a user to complete a [web flow through a browser](/docs/github), where the user should authorize Scalr to connect to their OAuth App. * `personal_token` - a pre-generated authentication token. This method works better if you need to fully automate the VCS provider creation. How to generate access tokens for different VCS providers: * [GitHub and GitHub Enterprise](https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token) * [GitLab and GitLab Enterprise](https://docs.gitlab.com/ce/user/profile/personal_access_tokens.html#creating-a-personal-access-token) * [Azure DevOps](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops-2019&tabs=preview-page) * [Bitbucket Data Center](https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html)
	AuthType VcsProviderAuthType `json:"auth-type"`
	// Designates whether to automatically merge the base branch into the head before run execution.
	AutoMerge bool `json:"auto-merge"`
	// Indicates whether checks are enabled for this VCS provider.
	ChecksEnabled bool `json:"checks-enabled"`
	// Indicates whether commenting on PRs is enabled for this VCS provider.
	CommentsEnabled bool `json:"comments-enabled"`
	// Designates which commit is compared with the head commit to produce diff changes.
	CompareStrategy VcsProviderCompareStrategy `json:"compare-strategy"`
	// Indicates whether the draft pull-request runs are enabled for this VCS provider.
	DraftPrRunsEnabled bool `json:"draft-pr-runs-enabled"`
	// Contains error message, if the connection to VCS provider is broken.
	ErrorMessage *string `json:"error-message"`
	// Indicates whether the VCS provider can be used in any account environments or only linked one.
	IsShared bool `json:"is-shared"`
	// VCS provider name, which must be unique within the account.
	Name string `json:"name"`
	// Indicates whether triggering dry runs from a PR comment is enabled for this VCS provider.
	PlansEnabled bool `json:"plans-enabled"`
	// Indicates whether comment should be posted on PR after merge with results of triggered runs.
	PrMergeCommentsEnabled bool `json:"pr-merge-comments-enabled"`
	// Access token for an API client for using to connect to the VCS Provider.
	Token *string `json:"token"`
	// The URL to the VCS provider installation. Required for GitHub Enterprise, GitLab Enterprise and Bitbucket Data Center.
	Url *string `json:"url"`
	// Username for personal_token auth type. This field is required for bitbucket_enterprise provider.
	Username *string `json:"username"`
	// VCS provider type.
	VcsType VcsProviderVcsType `json:"vcs-type"`
}

// VcsProviderRelationships holds the relationships for VcsProvider (response)
type VcsProviderRelationships struct {
	// The account that owns this VCS integration.
	Account *Account `json:"account"`
	// The ID of the agent pool to communicate with on-prem VCS provider that not accessible directly.
	AgentPool *AgentPool `json:"agent-pool"`
	// The list of environments this VCS integration is linked to.
	Environments []*Environment `json:"environments"`
}

// UnmarshalJSON implements custom unmarshalling for relationships
func (r *VcsProviderRelationships) UnmarshalJSON(data []byte) error {
	// Parse into temporary structure that matches JSON:API format
	var temp map[string]json.RawMessage
	if err := json.Unmarshal(data, &temp); err != nil {
		return err
	}

	if raw, ok := temp["account"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Account = &Account{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["agent-pool"]; ok {
		// To-one relationship
		var rel struct {
			Data *struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.AgentPool = &AgentPool{
				ID:   rel.Data.ID,
				Type: rel.Data.Type,
			}
		}
	}
	if raw, ok := temp["environments"]; ok {
		// To-many relationship
		var rel struct {
			Data []struct {
				ID   string `json:"id"`
				Type string `json:"type"`
			} `json:"data"`
		}
		if err := json.Unmarshal(raw, &rel); err != nil {
			return err
		}
		if rel.Data != nil {
			r.Environments = make([]*Environment, len(rel.Data))
			for i, d := range rel.Data {
				r.Environments[i] = &Environment{
					ID:   d.ID,
					Type: d.Type,
				}
			}
		}
	}
	return nil
}

// PopulateIncludes merges included resources into the relationships
func (r *VcsProviderRelationships) PopulateIncludes(included []map[string]interface{}) {
	if r == nil || len(included) == 0 {
		return
	}

	// Build a map of included resources by type+id for fast lookup
	includedMap := make(map[string]map[string]interface{})
	for _, inc := range included {
		if id, ok := inc["id"].(string); ok {
			if typ, ok := inc["type"].(string); ok {
				key := typ + ":" + id
				includedMap[key] = inc
			}
		}
	}

	// Populate to-one relationship: Account
	if r.Account != nil && r.Account.ID != "" {
		key := r.Account.Type + ":" + r.Account.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full Account
			if err := json.Unmarshal(data, &full); err == nil {
				r.Account = &full
			}
		}
	}
	// Populate to-one relationship: AgentPool
	if r.AgentPool != nil && r.AgentPool.ID != "" {
		key := r.AgentPool.Type + ":" + r.AgentPool.ID
		if fullResource, ok := includedMap[key]; ok {
			// Unmarshal the full resource
			data, _ := json.Marshal(fullResource)
			var full AgentPool
			if err := json.Unmarshal(data, &full); err == nil {
				r.AgentPool = &full
			}
		}
	}
	// Populate to-many relationship: Environments
	if r.Environments != nil {
		for i, resource := range r.Environments {
			if resource != nil && resource.ID != "" {
				key := resource.Type + ":" + resource.ID
				if fullResource, ok := includedMap[key]; ok {
					// Unmarshal the full resource
					data, _ := json.Marshal(fullResource)
					var full Environment
					if err := json.Unmarshal(data, &full); err == nil {
						r.Environments[i] = &full
					}
				}
			}
		}
	}
}

// Request version - used when marshalling for API requests
// The VCS Provider resource represents a connection between a Scalr account and a VCS, such as GitHub, Gitlab, Bitbucket, and Azure DevOps. (for requests)
type VcsProviderRequest struct {
	ID            string                          `json:"id,omitempty"`
	Type          string                          `json:"type,omitempty"`
	Attributes    VcsProviderAttributesRequest    `json:"attributes,omitempty"`
	Relationships VcsProviderRelationshipsRequest `json:"relationships,omitempty"`
}

// MarshalJSON automatically sets the Type field during marshalling
func (r VcsProviderRequest) MarshalJSON() ([]byte, error) {
	type Alias VcsProviderRequest
	if r.Type == "" {
		r.Type = "vcs-providers"
	}
	return json.Marshal((Alias)(r))
}

// GetID returns the resource ID (implements client.ResourceLike)
func (r VcsProviderRequest) GetID() string {
	return r.ID
}

// GetResourceType returns the JSON:API resource type (implements client.ResourceLike)
func (r VcsProviderRequest) GetResourceType() string {
	return "vcs-providers"
}

// VcsProviderAttributesRequest holds the attributes for VcsProvider (request)
type VcsProviderAttributesRequest struct {
	// Indicates whether triggering apply runs from a PR comment is enabled for this VCS provider.
	AppliesEnabled *value.Value[bool] `json:"applies-enabled,omitempty"`
	// Authentication type, the VCS API client is using to establish connection with the VCS. * `oauth2` - private OAuth App, user or organization creates in their VCS account. Setup through this method requires a user to complete a [web flow through a browser](/docs/github), where the user should authorize Scalr to connect to their OAuth App. * `personal_token` - a pre-generated authentication token. This method works better if you need to fully automate the VCS provider creation. How to generate access tokens for different VCS providers: * [GitHub and GitHub Enterprise](https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token) * [GitLab and GitLab Enterprise](https://docs.gitlab.com/ce/user/profile/personal_access_tokens.html#creating-a-personal-access-token) * [Azure DevOps](https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate?view=azure-devops-2019&tabs=preview-page) * [Bitbucket Data Center](https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html)
	AuthType *value.Value[VcsProviderAuthType] `json:"auth-type,omitempty"`
	// Designates whether to automatically merge the base branch into the head before run execution.
	AutoMerge *value.Value[bool] `json:"auto-merge,omitempty"`
	// Indicates whether checks are enabled for this VCS provider.
	ChecksEnabled *value.Value[bool] `json:"checks-enabled,omitempty"`
	// Indicates whether commenting on PRs is enabled for this VCS provider.
	CommentsEnabled *value.Value[bool] `json:"comments-enabled,omitempty"`
	// Designates which commit is compared with the head commit to produce diff changes.
	CompareStrategy *value.Value[VcsProviderCompareStrategy] `json:"compare-strategy,omitempty"`
	// Indicates whether the draft pull-request runs are enabled for this VCS provider.
	DraftPrRunsEnabled *value.Value[bool] `json:"draft-pr-runs-enabled,omitempty"`
	// Indicates whether the VCS provider can be used in any account environments or only linked one.
	IsShared *value.Value[bool] `json:"is-shared,omitempty"`
	// VCS provider name, which must be unique within the account.
	Name *value.Value[string] `json:"name,omitempty"`
	// Indicates whether triggering dry runs from a PR comment is enabled for this VCS provider.
	PlansEnabled *value.Value[bool] `json:"plans-enabled,omitempty"`
	// Indicates whether comment should be posted on PR after merge with results of triggered runs.
	PrMergeCommentsEnabled *value.Value[bool] `json:"pr-merge-comments-enabled,omitempty"`
	// Access token for an API client for using to connect to the VCS Provider.
	Token *value.Value[string] `json:"token,omitempty"`
	// The URL to the VCS provider installation. Required for GitHub Enterprise, GitLab Enterprise and Bitbucket Data Center.
	Url *value.Value[string] `json:"url,omitempty"`
	// Username for personal_token auth type. This field is required for bitbucket_enterprise provider.
	Username *value.Value[string] `json:"username,omitempty"`
	// VCS provider type.
	VcsType *value.Value[VcsProviderVcsType] `json:"vcs-type,omitempty"`
}

// VcsProviderRelationshipsRequest holds the relationships for VcsProvider (request)
type VcsProviderRelationshipsRequest struct {
	// The account that owns this VCS integration.
	Account *value.Value[Account] `json:"account,omitempty"`
	// The ID of the agent pool to communicate with on-prem VCS provider that not accessible directly.
	AgentPool *value.Value[AgentPool] `json:"agent-pool,omitempty"`
	// The list of environments this VCS integration is linked to.
	Environments *value.Value[[]Environment] `json:"environments,omitempty"`
}
