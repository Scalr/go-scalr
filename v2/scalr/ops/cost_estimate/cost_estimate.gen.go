// Code generated by scalr-gen. DO NOT EDIT.

package cost_estimate

import (
	"context"
	"encoding/json"
	"fmt"
	"io"
	"net/http"
	"net/url"
	"strings"

	"github.com/scalr/go-scalr/v2/scalr/client"
	"github.com/scalr/go-scalr/v2/scalr/schemas"
)

// Client provides access to CostEstimate operations
type Client struct {
	httpClient *client.HTTPClient
}

// New creates a new CostEstimate client
func New(httpClient *client.HTTPClient) *Client {
	return &Client{httpClient: httpClient}
}

// Show details of a specific Cost Estimate phase.
func (c *Client) GetCostEstimateRaw(ctx context.Context, costEstimate string) (*http.Response, error) {
	path := "/cost-estimates/{cost_estimate}"
	path = strings.ReplaceAll(path, "{cost_estimate}", url.PathEscape(costEstimate))

	return c.httpClient.Get(ctx, path, nil)
}

// Show details of a specific Cost Estimate phase.
func (c *Client) GetCostEstimate(ctx context.Context, costEstimate string) (*schemas.CostEstimate, *client.Response, error) {
	httpResp, err := c.GetCostEstimateRaw(ctx, costEstimate)
	if err != nil {
		return nil, nil, err
	}
	defer httpResp.Body.Close()

	resp := &client.Response{Response: httpResp}

	var result struct {
		Data     schemas.CostEstimate     `json:"data"`
		Included []map[string]interface{} `json:"included"`
	}
	if err := json.NewDecoder(httpResp.Body).Decode(&result); err != nil {
		return nil, resp, fmt.Errorf("failed to decode response: %w", err)
	}

	return &result.Data, resp, nil
}

// This endpoint generates a temporary public URL, that can be used to download a [JSON formatted cost breakdown](https://www.infracost.io/docs/multi_project/report/#examples).
func (c *Client) GetCostEstimateBreakdownRaw(ctx context.Context, costEstimate string) (*http.Response, error) {
	path := "/cost-estimates/{cost_estimate}/breakdown"
	path = strings.ReplaceAll(path, "{cost_estimate}", url.PathEscape(costEstimate))

	return c.httpClient.Get(ctx, path, nil)
}

// This endpoint generates a temporary public URL, that can be used to download a [JSON formatted cost breakdown](https://www.infracost.io/docs/multi_project/report/#examples).
func (c *Client) GetCostEstimateBreakdown(ctx context.Context, costEstimate string) (*client.Response, error) {
	httpResp, err := c.GetCostEstimateBreakdownRaw(ctx, costEstimate)
	if err != nil {
		return nil, err
	}
	defer httpResp.Body.Close()

	resp := &client.Response{Response: httpResp}

	return resp, nil
}

// This endpoint generates a temporary public URL, that can be used to download a raw `text/plan` output of the cost estimation.
func (c *Client) GetCostEstimateLogRaw(ctx context.Context, costEstimate string) (*http.Response, error) {
	path := "/cost-estimates/{cost_estimate}/output"
	path = strings.ReplaceAll(path, "{cost_estimate}", url.PathEscape(costEstimate))

	return c.httpClient.Get(ctx, path, nil)
}

// This endpoint generates a temporary public URL, that can be used to download a raw `text/plan` output of the cost estimation.
func (c *Client) GetCostEstimateLog(ctx context.Context, costEstimate string) (string, *client.Response, error) {
	httpResp, err := c.GetCostEstimateLogRaw(ctx, costEstimate)
	if err != nil {
		return "", nil, err
	}
	defer httpResp.Body.Close()

	resp := &client.Response{Response: httpResp}

	bodyBytes, err := io.ReadAll(httpResp.Body)
	if err != nil {
		return "", resp, fmt.Errorf("failed to read response body: %w", err)
	}
	return string(bodyBytes), resp, nil
}
